var audio,sources,timer,currentAPI,ustream,youtube,thisId,prevId,nextId,retry,youtubeTime,volume=$("#slider").val(),audioTime=0,url=window.location.href,param=url.split("?")[1];function Timer(){"HTML5"==currentAPI?audioTime=audio.currentTime:audioTime++;var e=Math.floor(audioTime/60),a=Math.floor(audioTime%60);a<10&&(a="0"+a),$(".timer").text(e+":"+a)}function resetClasses(){$(".playing").removeClass("playing"),$(".loading").removeClass("loading"),$(".offline").removeClass("offline")}function showName(e){var a=$(e).find(".station").text(),t=$(e).find(".frequency").text();$(".current-name").text(a),$(".current-freq").text(t)}function updateURL(e){window.history.replaceState("","","?"+e)}function updatePageTitle(e){var a=$("#"+e).find(".station").text()+" - "+$("#"+e).find(".frequency").text();document.title=a}function loadStream(e){var a=stations[e];if(".m3u8"==a[0].slice(-5)){currentAPI="HTML5",$("#player").html('<audio id="audio" controls></audio>'),audio=document.getElementById("audio");var t=new Hls;t.loadSource(a[0]),t.attachMedia(audio)}else if(a[0].match(/ustream/))currentAPI="USTREAM",$("#player").html('<iframe id="UstreamFrame" src="'+a[0]+'"></iframe>'),ustream=UstreamEmbed("UstreamFrame");else if(a[0].match(/youtube/))currentAPI="YOUTUBE",$("#player").html('<iframe id="YoutubeFrame" src="'+a[0]+'"></iframe>'),$.getScript("https://www.youtube.com/iframe_api",function(){readyYoutube()});else{currentAPI="HTML5",$("#player").html('<audio id="audio" controls></audio>');for(var o=0;o<a.length;o++)$("#audio").append("<source src="+a[o]+" />")}}function readyYoutube(){"undefined"!=typeof YT&&YT&&YT.Player?youtube=new YT.Player("YoutubeFrame",{events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange,onError:onPlayerError}}):setTimeout(readyYoutube,100)}function onPlayerReady(e){youtube.unMute(),youtube.setVolume(Math.floor(100*volume)),e.target.playVideo()}function onPlayerStateChange(e){switch(e.data){case YT.PlayerState.PLAYING:showPlaying();break;case YT.PlayerState.BUFFERING:case YT.PlayerState.CUED:showLoading();break;case YT.PlayerState.ENDED:showError()}}function playYoutube(){youtube.playVideo()}function onPlayerError(){showError()}function playAudio(){switch(currentAPI){case"HTML5":playHTML5Audio();break;case"USTREAM":playUStream()}}function pauseAudio(){audio&&(audio.hasAttribute("src")&&($("#audio").attr("src",""),audio.load(),$("#audio").removeAttr("src")),$(sources).attr("src",""),audio.load(),$(sources).remove(),audio.pause(),$(audio).remove()),$("#UstreamFrame").remove(),$("#YoutubeFrame").remove(),clearInterval(timer)}function playHTML5Audio(){(audio=document.getElementById("audio"),sources=document.getElementsByTagName("source"),audio.muted=!1,audio.volume=volume,audio.load(),audio.addEventListener("loadstart",function(){showLoading()}),audio.addEventListener("waiting",function(){showLoading()}),audio.addEventListener("canplay",function(){audio.play(),retry=0}),audio.addEventListener("playing",function(){showPlaying()}),audio.addEventListener("error",function(){retry<2?(retry++,playHTML5Audio()):showError()}),0!==sources.length)&&sources[sources.length-1].addEventListener("error",function(){retry<2?(retry++,playHTML5Audio()):showError()})}function playUStream(){ustream.callMethod("volume",Math.floor(100*volume));var e=function(e,a){switch(e){case"ready":showLoading(),ustream.callMethod("play");break;case"playing":setTimeout(function(){showPlaying()},3e3);break;case"finished":case"offline":showError()}};ustream.addListener("ready",e),ustream.addListener("live",e),ustream.addListener("playing",e),ustream.addListener("finished",e),ustream.addListener("offline",e)}function showLoading(){$(".selected").removeClass("playing offline").addClass("loading")}function showPlaying(){$(".selected").removeClass("loading offline").addClass("playing");var e=$(".playing").find(".frequency").text();$(".current-freq").html(e+' <span class="badge on">Live</span>'),clearInterval(timer),timer=setInterval(Timer,1e3)}function showError(){$(".selected").removeClass("selected playing loading").addClass("last offline");var e=$(".offline").find(".frequency").text();$(".current-freq").html(e+' <span class="badge off">Offline</span>'),$(".i-play").removeClass("on")}function updateVolumeIcon(){0==volume?$(".i-volume").removeClass("low high").addClass("mute"):volume<.5?$(".i-volume").removeClass("mute high").addClass("low"):.5<=volume&&$(".i-volume").removeClass("mute low").addClass("high")}function updateThumb(e){var a=$(e).find("img").attr("data-src");$(".preview img").attr("src",a)}param?($("#"+param).addClass("last").siblings().removeClass("last selected"),showName("#"+param),updateThumb("#"+param),updatePageTitle(param)):($(".gallery li:first").addClass("last").siblings().removeClass("last selected"),showName("#loveradio"),updateThumb("#loveradio"),currentAPI="HTML5"),$(".gallery>li, .i-prev, .i-next").on("click",function(){$(".timer").text("0:00"),audioTime=0,pauseAudio(),retry=0,resetClasses()}),$(".gallery>li").on("click",function(){$(".last").removeClass("last"),showName($(this)),updateThumb($(this)),updateURL($(this).attr("id")),updatePageTitle($(this).attr("id")),$(this).hasClass("selected")?(pauseAudio(),$(this).addClass("last").removeClass("selected").siblings().removeClass("selected"),$(".i-play").removeClass("on")):(loadStream(thisId=$(this).attr("id")),playAudio(),$(this).addClass("selected").siblings().removeClass("selected"),$(".i-play").addClass("on"))}),$(".i-prev").on("click",function(){loadStream(prevId=$(".last, .selected").prevAll(":visible").first().attr("id")),playAudio(),$(".last, .selected").removeClass("selected last").prevAll(":visible").first().addClass("selected"),$(".i-play").addClass("on"),showName("#"+prevId),updateThumb("#"+prevId),updateURL(prevId),updatePageTitle(prevId)}),$(".i-next").on("click",function(){loadStream(nextId=$(".last, .selected").nextAll(":visible").first().attr("id")),playAudio(),$(".last, .selected").removeClass("selected last").nextAll(":visible").first().addClass("selected"),$(".i-play").addClass("on"),showName("#"+nextId),updateThumb("#"+nextId),updateURL(nextId),updatePageTitle(nextId)}),$(".i-play").on("click",function(){$(".timer").text("0:00"),retry=audioTime=0,resetClasses(),$(this).hasClass("on")?(pauseAudio(),$(".i-play").removeClass("on"),$(".selected").addClass("last").removeClass("selected")):(loadStream(thisId=$(".last").attr("id")),playAudio(),$(".i-play").addClass("on"),$(".last").addClass("selected").removeClass("last"))}),audio=document.getElementById("audio"),win<=992?(volume=1,$("#slider").val(1)):(volume=.5,$("#slider").val(.5)),audio&&(audio.volume=volume),updateVolumeIcon(),$("#slider").on("input change",function(){switch(volume=$(this).val(),currentAPI){case"HTML5":audio.volume=volume;break;case"USTREAM":ustream.callMethod("volume",Math.floor(100*volume));break;case"YOUTUBE":youtube.setVolume(Math.floor(100*volume))}updateVolumeIcon()}),$(document).ready(function(){$(".volume-control").on("click",".low, .high",function(){switch(currentAPI){case"HTML5":audio.volume=0;break;case"USTREAM":ustream.callMethod("volume",0);break;case"YOUTUBE":youtube.setVolume(0)}volume=0,$("#slider").val(0),updateVolumeIcon()}),$(".volume-control").on("click",".mute",function(){switch(currentAPI){case"HTML5":audio.volume=.5;break;case"USTREAM":ustream.callMethod("volume",50);break;case"YOUTUBE":youtube.setVolume(50)}volume=.5,$("#slider").val(volume),updateVolumeIcon()})}),$(".gallery>li, .i-prev, .i-next").on("click",function(){var e=$(".last, .selected").prevAll(":visible").first().length,a=$(".last, .selected").nextAll(":visible").first().length;0==e?$(".i-prev").attr("disabled",!0):$(".i-prev").removeAttr("disabled"),0==a?$(".i-next").attr("disabled",!0):$(".i-next").removeAttr("disabled")});
